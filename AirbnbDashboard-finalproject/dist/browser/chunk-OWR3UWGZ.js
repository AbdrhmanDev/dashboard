import{a as Z}from"./chunk-AJK7QTCT.js";import{a as dt}from"./chunk-IIOWY6P7.js";import{a as Ot,b as Vt,c as P,d as Ft,e as T,f as Lt,g as Rt}from"./chunk-U5BSPRHP.js";import{a as Mt,b as yt,c as bt,d as xt,e as Bt,f as wt,g as vt,h as Dt,i as Pt,j as Tt,k as Et,l as It}from"./chunk-BMRYDPI6.js";import{a as Ct,b as kt,c as ht,d as St}from"./chunk-LYOMZ3DP.js";import{a as lt,c as st,e as mt,h as ct,i as pt,j as _t,k as ft}from"./chunk-WCCRWDMN.js";import{c as K,g as U,k as X,y as Y}from"./chunk-KW4BC5VN.js";import{a as ut,b as gt}from"./chunk-PIP2ZZCO.js";import{Q as tt,Y as et,ba as nt,ca as it,da as ot,e as J,ea as at,f as q,fa as rt,i as G}from"./chunk-CTSDR7KC.js";import"./chunk-JSBFFIL7.js";import{Bb as p,Lb as o,Mb as a,Nb as S,Ob as C,Pb as k,Qc as H,Rb as B,Rc as A,Sc as Q,Tb as f,Ub as _,Wc as $,Yb as E,Zb as I,_b as O,_c as j,bc as V,cc as r,dc as W,eb as s,ec as h,gc as y,hc as b,ic as x,jb as D,kc as N,lc as z,nc as w,oa as d,oc as v,pa as u,qb as R,ub as g}from"./chunk-3C7H3B7F.js";var At=()=>[5,10,25,100],Qt=n=>["/bookings",n];function $t(n,e){if(n&1&&(o(0,"mat-option",18),r(1),w(2,"titlecase"),a()),n&2){let t=e.$implicit;p("value",t),s(),h(" ",v(2,2,t)," ")}}function jt(n,e){if(n&1&&(o(0,"mat-option",18),r(1),w(2,"titlecase"),a()),n&2){let t=e.$implicit;p("value",t),s(),h(" ",v(2,2,t)," ")}}function Jt(n,e){n&1&&S(0,"div",19)}function qt(n,e){n&1&&(o(0,"th",36),r(1,"Booking ID"),a())}function Gt(n,e){if(n&1&&(o(0,"td",37),r(1),a()),n&2){let t=e.$implicit;s(),W(t._id)}}function Kt(n,e){n&1&&(o(0,"th",36),r(1,"Companions"),a())}function Ut(n,e){if(n&1&&(o(0,"td",37),r(1),a()),n&2){let t=e.$implicit;s(),h(" ",t.properties[0]==null?null:t.properties[0].companions," ")}}function Xt(n,e){n&1&&(o(0,"th",36),r(1,"Start Date"),a())}function Yt(n,e){if(n&1&&(o(0,"td",37),r(1),a()),n&2){let t=e.$implicit,i=_(2);s(),h(" ",i.formatDate(t.properties[0]==null?null:t.properties[0].startDate)," ")}}function Zt(n,e){n&1&&(o(0,"th",36),r(1,"End Date"),a())}function te(n,e){if(n&1&&(o(0,"td",37),r(1),a()),n&2){let t=e.$implicit,i=_(2);s(),h(" ",i.formatDate(t.properties[0]==null?null:t.properties[0].endDate)," ")}}function ee(n,e){n&1&&(o(0,"th",36),r(1,"Status"),a())}function ne(n,e){if(n&1&&(o(0,"td",37)(1,"span",38),r(2),w(3,"titlecase"),a()()),n&2){let t=e.$implicit,i=_(2);s(),p("ngClass",i.getStatusClass(t.properties[0]==null?null:t.properties[0].status)),s(),h(" ",v(3,2,t.properties[0]==null?null:t.properties[0].status)," ")}}function ie(n,e){n&1&&(o(0,"th",36),r(1," Payment Status "),a())}function oe(n,e){if(n&1&&(o(0,"td",37)(1,"span",38),r(2),w(3,"titlecase"),a()()),n&2){let t=e.$implicit,i=_(2);s(),p("ngClass",i.getPaymentStatusClass(t.properties[0]==null?null:t.properties[0].paymentMethod)),s(),h(" ",v(3,2,t.properties[0]==null?null:t.properties[0].paymentMethod)," ")}}function ae(n,e){n&1&&(o(0,"th",36),r(1,"Total Price"),a())}function re(n,e){if(n&1&&(o(0,"td",37),r(1),a()),n&2){let t=e.$implicit;s(),h(" $",t.properties[0]==null?null:t.properties[0].totalPrice," ")}}function le(n,e){n&1&&(o(0,"th",39),r(1,"Actions"),a())}function se(n,e){if(n&1){let t=B();o(0,"button",44),f("click",function(){d(t);let l=_().$implicit,m=_(2);return u(m.confirmBooking(l._id))}),o(1,"mat-icon"),r(2,"check_circle"),a()()}}function me(n,e){if(n&1){let t=B();o(0,"button",45),f("click",function(){d(t);let l=_().$implicit,m=_(2);return u(m.cancelBooking(l._id))}),o(1,"mat-icon"),r(2,"cancel"),a()()}}function ce(n,e){if(n&1){let t=B();o(0,"td",37)(1,"button",40),f("click",function(){let l=d(t).$implicit,m=_(2);return u(m.viewBooking(l._id))}),o(2,"mat-icon"),r(3,"visibility"),a()(),g(4,se,3,0,"button",41)(5,me,3,0,"button",42),o(6,"button",43),f("click",function(){let l=d(t).$implicit,m=_(2);return u(m.deleteBooking(l._id))}),o(7,"mat-icon"),r(8,"delete"),a()()()}if(n&2){let t=e.$implicit;s(),p("routerLink",z(3,Qt,t._id)),s(3),p("ngIf",(t.properties[0]==null?null:t.properties[0].status)==="pending"),s(),p("ngIf",(t.properties[0]==null?null:t.properties[0].status)!=="cancelled"&&(t.properties[0]==null?null:t.properties[0].status)!=="completed")}}function pe(n,e){n&1&&S(0,"tr",46)}function de(n,e){n&1&&S(0,"tr",47)}function ue(n,e){if(n&1&&(o(0,"div",20)(1,"table",21),C(2,22),g(3,qt,2,0,"th",23)(4,Gt,2,1,"td",24),k(),C(5,25),g(6,Kt,2,0,"th",23)(7,Ut,2,1,"td",24),k(),C(8,26),g(9,Xt,2,0,"th",23)(10,Yt,2,1,"td",24),k(),C(11,27),g(12,Zt,2,0,"th",23)(13,te,2,1,"td",24),k(),C(14,28),g(15,ee,2,0,"th",23)(16,ne,4,4,"td",24),k(),C(17,29),g(18,ie,2,0,"th",23)(19,oe,4,4,"td",24),k(),C(20,30),g(21,ae,2,0,"th",23)(22,re,2,1,"td",24),k(),C(23,31),g(24,le,2,0,"th",32)(25,ce,9,5,"td",24),k(),g(26,pe,1,0,"tr",33)(27,de,1,0,"tr",34),a(),S(28,"mat-paginator",35),a()),n&2){let t=_();s(),p("dataSource",t.dataSource),s(25),p("matHeaderRowDef",t.displayedColumns),s(),p("matRowDefColumns",t.displayedColumns),s(),p("pageSizeOptions",N(4,At))}}function ge(n,e){n&1&&(o(0,"div",48)(1,"mat-icon"),r(2,"event_busy"),a(),o(3,"p"),r(4,"No bookings found"),a()())}var Wt=class n{constructor(e,t,i){this.bookingService=e;this.snackBar=t;this.router=i}displayedColumns=["propertyId","companions","startDate","endDate","status","paymentStatus","totalPrice","actions"];dataSource=new It;isLoading=!0;selectedStatus="all";selectedPaymentStatus="all";searchTerm="";startDate=null;endDate=null;bookingStatuses=["pending","confirmed","cancelled","completed"];paymentStatuses=["pending","paid","failed"];paginator;sort;ngOnInit(){this.loadBookings()}ngAfterViewInit(){this.dataSource.paginator=this.paginator,this.dataSource.sort=this.sort,this.dataSource.filterPredicate=this.createFilter()}loadBookings(){this.isLoading=!0,this.bookingService.getBookings().subscribe({next:e=>{console.log("Raw bookings response:",JSON.stringify(e,null,2)),e.forEach((t,i)=>{console.log(`Booking ${i+1}:`,{id:t._id,userId:t.userId,properties:t.properties.map(l=>({propertyId:l.propertyId,status:l.status,totalPrice:l.totalPrice,startDate:l.startDate,endDate:l.endDate}))})}),this.dataSource.data=e,console.log("Table data source updated with:",this.dataSource.data),this.isLoading=!1},error:e=>{this.snackBar.open("Error loading bookings: "+e.message,"Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.isLoading=!1}})}createFilter(){return(e,t)=>{if(!t)return!0;try{let i=JSON.parse(t),l=!i.searchTerm||e._id?.toString().toLowerCase().includes(i.searchTerm.toLowerCase())||e.properties.some(M=>M.propertyId?.toString().toLowerCase().includes(i.searchTerm.toLowerCase()))||typeof e.userId!="string"&&e.userId?.name?.toLowerCase().includes(i.searchTerm.toLowerCase()),m=!i.status||i.status==="all"||e.properties.some(M=>M.status===i.status),c=!i.paymentStatus||i.paymentStatus==="all",F=i.startDate?new Date(i.startDate):null,L=i.endDate?new Date(i.endDate):null,Nt=e.properties.some(M=>{let zt=new Date(M.startDate),Ht=new Date(M.endDate);return(!F||zt>=F)&&(!L||Ht<=L)});return l&&m&&c&&Nt}catch(i){return console.error("Error parsing filter:",i),!0}}}viewBooking(e){console.log(e),this.router.navigate(["/bookings/details",e])}applyFilter(){let e=JSON.stringify({searchTerm:this.searchTerm?.trim()||"",status:this.selectedStatus,paymentStatus:this.selectedPaymentStatus,startDate:this.startDate?.toISOString(),endDate:this.endDate?.toISOString()});this.dataSource.filter=e,this.dataSource.paginator&&this.dataSource.paginator.firstPage()}resetFilters(){this.searchTerm="",this.selectedStatus="all",this.selectedPaymentStatus="all",this.startDate=null,this.endDate=null,this.applyFilter()}getStatusClass(e){return{pending:"status-pending",confirmed:"status-confirmed",cancelled:"status-cancelled",completed:"status-completed"}[e]}getPaymentStatusClass(e){return{pending:"payment-pending",paid:"payment-paid",failed:"payment-failed"}[e]}formatDate(e){return new Date(e).toLocaleDateString()}confirmBooking(e){this.bookingService.confirmBooking(e).subscribe({next:()=>{this.snackBar.open("Booking confirmed successfully","Close",{duration:3e3}),this.loadBookings()},error:t=>{this.snackBar.open("Error confirming booking: "+t.message,"Close",{duration:3e3})}})}cancelBooking(e){confirm("Are you sure you want to cancel this booking?")&&this.bookingService.cancelBooking(e).subscribe({next:()=>{this.snackBar.open("Booking cancelled successfully","Close",{duration:3e3}),this.loadBookings()},error:t=>{this.snackBar.open("Error cancelling booking: "+t.message,"Close",{duration:3e3})}})}deleteBooking(e){confirm("Are you sure you want to delete this booking? This action cannot be undone.")&&this.bookingService.deleteBooking(e).subscribe({next:()=>{this.snackBar.open("Booking deleted successfully","Close",{duration:3e3}),this.loadBookings()},error:t=>{this.snackBar.open("Error deleting booking: "+t.message,"Close",{duration:3e3})}})}static \u0275fac=function(t){return new(t||n)(D(Z),D(ut),D(J))};static \u0275cmp=R({type:n,selectors:[["app-bookings"]],viewQuery:function(t,i){if(t&1&&(E(P,5),E(T,5)),t&2){let l;I(l=O())&&(i.paginator=l.first),I(l=O())&&(i.sort=l.first)}},decls:48,vars:14,consts:[["startPicker",""],["endPicker",""],[1,"page-container"],[1,"header"],[1,"subtitle"],[1,"filters-container"],["appearance","outline"],["matInput","","placeholder","Search by property or booking ID",3,"ngModelChange","keyup","ngModel"],["matSuffix",""],[3,"ngModelChange","selectionChange","ngModel"],["value","all"],[3,"value",4,"ngFor","ngForOf"],["matInput","",3,"ngModelChange","dateChange","matDatepicker","ngModel"],["matSuffix","",3,"for"],["mat-stroked-button","","color","primary",3,"click"],["class","loading-spinner",4,"ngIf"],["class","table-container",4,"ngIf"],["class","no-data",4,"ngIf"],[3,"value"],[1,"loading-spinner"],[1,"table-container"],["mat-table","","matSort","",1,"mat-elevation-z8",3,"dataSource"],["matColumnDef","propertyId"],["mat-header-cell","","mat-sort-header","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","companions"],["matColumnDef","startDate"],["matColumnDef","endDate"],["matColumnDef","status"],["matColumnDef","paymentStatus"],["matColumnDef","totalPrice"],["matColumnDef","actions"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","","aria-label","Select page of bookings",3,"pageSizeOptions"],["mat-header-cell","","mat-sort-header",""],["mat-cell",""],[1,"status-chip",3,"ngClass"],["mat-header-cell",""],["mat-icon-button","","color","primary","matTooltip","View Details",3,"click","routerLink"],["mat-icon-button","","color","accent","matTooltip","Confirm Booking",3,"click",4,"ngIf"],["mat-icon-button","","color","warn","matTooltip","Cancel Booking",3,"click",4,"ngIf"],["mat-icon-button","","color","warn","matTooltip","Delete Booking",3,"click"],["mat-icon-button","","color","accent","matTooltip","Confirm Booking",3,"click"],["mat-icon-button","","color","warn","matTooltip","Cancel Booking",3,"click"],["mat-header-row",""],["mat-row",""],[1,"no-data"]],template:function(t,i){if(t&1){let l=B();o(0,"div",2)(1,"div",3)(2,"h1"),r(3,"Bookings"),a(),o(4,"p",4),r(5,"Manage and track all bookings"),a()(),o(6,"div",5)(7,"mat-form-field",6)(8,"mat-label"),r(9,"Search"),a(),o(10,"input",7),x("ngModelChange",function(c){return d(l),b(i.searchTerm,c)||(i.searchTerm=c),u(c)}),f("keyup",function(){return d(l),u(i.applyFilter())}),a(),o(11,"mat-icon",8),r(12,"search"),a()(),o(13,"mat-form-field",6)(14,"mat-label"),r(15,"Booking Status"),a(),o(16,"mat-select",9),x("ngModelChange",function(c){return d(l),b(i.selectedStatus,c)||(i.selectedStatus=c),u(c)}),f("selectionChange",function(){return d(l),u(i.applyFilter())}),o(17,"mat-option",10),r(18,"All"),a(),g(19,$t,3,4,"mat-option",11),a()(),o(20,"mat-form-field",6)(21,"mat-label"),r(22,"Payment Status"),a(),o(23,"mat-select",9),x("ngModelChange",function(c){return d(l),b(i.selectedPaymentStatus,c)||(i.selectedPaymentStatus=c),u(c)}),f("selectionChange",function(){return d(l),u(i.applyFilter())}),o(24,"mat-option",10),r(25,"All"),a(),g(26,jt,3,4,"mat-option",11),a()(),o(27,"mat-form-field",6)(28,"mat-label"),r(29,"Start Date"),a(),o(30,"input",12),x("ngModelChange",function(c){return d(l),b(i.startDate,c)||(i.startDate=c),u(c)}),f("dateChange",function(){return d(l),u(i.applyFilter())}),a(),S(31,"mat-datepicker-toggle",13)(32,"mat-datepicker",null,0),a(),o(34,"mat-form-field",6)(35,"mat-label"),r(36,"End Date"),a(),o(37,"input",12),x("ngModelChange",function(c){return d(l),b(i.endDate,c)||(i.endDate=c),u(c)}),f("dateChange",function(){return d(l),u(i.applyFilter())}),a(),S(38,"mat-datepicker-toggle",13)(39,"mat-datepicker",null,1),a(),o(41,"button",14),f("click",function(){return d(l),u(i.resetFilters())}),o(42,"mat-icon"),r(43,"clear"),a(),r(44," Reset Filters "),a()(),g(45,Jt,1,0,"div",15)(46,ue,29,5,"div",16)(47,ge,5,0,"div",17),a()}if(t&2){let l=V(33),m=V(40);s(10),y("ngModel",i.searchTerm),s(6),y("ngModel",i.selectedStatus),s(3),p("ngForOf",i.bookingStatuses),s(4),y("ngModel",i.selectedPaymentStatus),s(3),p("ngForOf",i.paymentStatuses),s(4),p("matDatepicker",l),y("ngModel",i.startDate),s(),p("for",l),s(6),p("matDatepicker",m),y("ngModel",i.endDate),s(),p("for",m),s(7),p("ngIf",i.isLoading),s(),p("ngIf",!i.isLoading),s(),p("ngIf",!i.isLoading&&i.dataSource.data.length===0)}},dependencies:[j,H,A,Q,$,G,q,Y,K,U,X,Et,Mt,bt,vt,xt,yt,Dt,Bt,wt,Pt,Tt,Ft,P,Rt,T,Lt,pt,ct,mt,lt,st,ft,_t,et,ot,nt,it,rt,at,gt,St,Ct,kt,ht,tt,dt,Vt,Ot],styles:[".page-container[_ngcontent-%COMP%]{padding:24px;max-width:1400px;margin:0 auto}.header[_ngcontent-%COMP%]{margin-bottom:24px}.header[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:2rem;font-weight:500;margin:0;color:#333}.subtitle[_ngcontent-%COMP%]{color:#666;margin:8px 0 0}.filters-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:16px;margin-bottom:24px;align-items:center}.filters-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1;min-width:200px;max-width:300px}.loading-spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;padding:48px}.table-container[_ngcontent-%COMP%]{background:#fff;border-radius:8px;overflow:hidden;box-shadow:0 2px 4px #0000001a}table[_ngcontent-%COMP%]{width:100%}.mat-mdc-row[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.mat-mdc-header-cell[_ngcontent-%COMP%]{font-weight:600;color:#333}.mat-mdc-cell[_ngcontent-%COMP%]{color:#666}.status-chip[_ngcontent-%COMP%]{padding:4px 12px;border-radius:16px;font-size:.875rem;font-weight:500;display:inline-block}.status-pending[_ngcontent-%COMP%]{background-color:#fff3e0;color:#e65100}.status-confirmed[_ngcontent-%COMP%]{background-color:#e8f5e9;color:#2e7d32}.status-cancelled[_ngcontent-%COMP%]{background-color:#ffebee;color:#c62828}.status-completed[_ngcontent-%COMP%]{background-color:#e3f2fd;color:#1565c0}.payment-pending[_ngcontent-%COMP%]{background-color:#fff3e0;color:#e65100}.payment-paid[_ngcontent-%COMP%]{background-color:#e8f5e9;color:#2e7d32}.payment-failed[_ngcontent-%COMP%]{background-color:#ffebee;color:#c62828}.mat-mdc-icon-button[_ngcontent-%COMP%]{width:36px;height:36px;line-height:36px}.no-data[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:48px;color:#666}.no-data[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{font-size:48px;width:48px;height:48px;margin-bottom:16px;color:#999}.no-data[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:1.125rem;margin:0}@media (max-width: 600px){.page-container[_ngcontent-%COMP%]{padding:16px}.filters-container[_ngcontent-%COMP%]{flex-direction:column}.filters-container[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%;max-width:none}.mat-mdc-cell[_ngcontent-%COMP%]{font-size:.875rem}.status-chip[_ngcontent-%COMP%]{font-size:.75rem;padding:2px 8px}}"]})};export{Wt as BookingsComponent};
