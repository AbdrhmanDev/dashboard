import{a as pe,b as ce,c as ue,d as fe}from"./chunk-U3HJ22RD.js";import{a as X,b as Z,c as ee,e as te,f as re,h as ie,i as ne,j as se,k as de}from"./chunk-FDD2ZDR5.js";import{c as V,e as p,g as L,h as q,l as A,o as G,p as N,q as R,x as z,z as j}from"./chunk-KW4BC5VN.js";import{a as ae,c as oe}from"./chunk-DHE5MOO3.js";import{a as $}from"./chunk-3T5IVP2F.js";import{a as le,b as me}from"./chunk-KPISRMUR.js";import{Q as Y,Y as H,ba as J,c as D,da as K,e as T,ea as Q,fa as W}from"./chunk-4NHH6NUH.js";import"./chunk-FN5D4CQR.js";import{Bb as d,Lb as i,Mb as r,Nb as u,Rb as w,Sc as k,Tb as C,Ub as f,_c as B,a as P,ab as I,b as F,bc as E,cc as n,eb as l,ec as h,f as O,jb as _,oa as x,pa as v,qb as U,ub as c}from"./chunk-3C7H3B7F.js";function he(a,e){a&1&&(i(0,"div",10),u(1,"mat-spinner",11),r())}function _e(a,e){if(a&1&&(i(0,"mat-error"),n(1),r()),a&2){let t=f(2);l(),h(" ",t.getErrorMessage("name")," ")}}function xe(a,e){if(a&1&&(i(0,"mat-error"),n(1),r()),a&2){let t=f(2);l(),h(" ",t.getErrorMessage("email")," ")}}function ve(a,e){if(a&1&&(i(0,"mat-error"),n(1),r()),a&2){let t=f(2);l(),h(" ",t.getErrorMessage("phone")," ")}}function Ce(a,e){if(a&1&&(i(0,"mat-error",41),n(1),r()),a&2){let t=f(2);l(),h(" ",t.getErrorMessage("dateOfBirth")," ")}}function Ee(a,e){a&1&&(i(0,"mat-error"),n(1," Country is required "),r())}function Me(a,e){a&1&&(i(0,"mat-error"),n(1," City is required "),r())}function be(a,e){if(a&1&&(i(0,"mat-error"),n(1),r()),a&2){let t=f(2);l(),h(" ",t.getErrorMessage("role")," ")}}function Se(a,e){if(a&1){let t=w();i(0,"form",12),C("ngSubmit",function(){x(t);let s=f();return v(s.onSubmit())}),i(1,"div",13)(2,"mat-form-field",14)(3,"mat-label"),n(4,"First Name"),r(),u(5,"input",15),c(6,_e,2,1,"mat-error",16),r()(),i(7,"div",13)(8,"mat-form-field",14)(9,"mat-label"),n(10,"Email"),r(),u(11,"input",17),c(12,xe,2,1,"mat-error",16),r(),i(13,"mat-form-field",14)(14,"mat-label"),n(15,"Phone"),r(),u(16,"input",18),c(17,ve,2,1,"mat-error",16),r()(),i(18,"div",13)(19,"mat-form-field",14)(20,"mat-label"),n(21,"Date of Birth"),r(),u(22,"input",19)(23,"mat-datepicker-toggle",20)(24,"mat-datepicker",null,0),c(26,Ce,2,1,"mat-error",21),r(),i(27,"mat-form-field",14)(28,"mat-label"),n(29,"Gender"),r(),i(30,"mat-select",22)(31,"mat-option",23),n(32,"Male"),r(),i(33,"mat-option",24),n(34,"Female"),r()()()(),i(35,"div",25)(36,"mat-form-field",14)(37,"mat-label"),n(38,"Country"),r(),u(39,"input",26),c(40,Ee,2,0,"mat-error",16),r(),i(41,"mat-form-field",14)(42,"mat-label"),n(43,"City"),r(),u(44,"input",27),c(45,Me,2,0,"mat-error",16),r()(),i(46,"div",13)(47,"mat-form-field",14)(48,"mat-label"),n(49,"Role"),r(),i(50,"mat-select",28)(51,"mat-option",29),n(52,"Guest"),r(),i(53,"mat-option",30),n(54,"Host"),r(),i(55,"mat-option",31),n(56,"Admin"),r()(),c(57,be,2,1,"mat-error",16),r()(),i(58,"div",13)(59,"div",32)(60,"div",33),u(61,"img",34),r(),i(62,"div",35)(63,"input",36,1),C("change",function(s){x(t);let g=f();return v(g.onFileSelected(s))}),r(),i(65,"button",37),C("click",function(){x(t);let s=E(64);return v(s.click())}),i(66,"mat-icon"),n(67,"cloud_upload"),r(),n(68),r()()()(),i(69,"div",38)(70,"button",39),n(71," Cancel "),r(),i(72,"button",40),n(73," Save Changes "),r()()()}if(a&2){let t,o,s,g,M,b,S,y=E(25),m=f();d("formGroup",m.userForm),l(6),d("ngIf",(t=m.userForm.get("name"))==null?null:t.invalid),l(6),d("ngIf",(o=m.userForm.get("email"))==null?null:o.invalid),l(5),d("ngIf",(s=m.userForm.get("phone"))==null?null:s.invalid),l(5),d("matDatepicker",y)("max",m.maxDate),l(),d("for",y),l(3),d("ngIf",(g=m.userForm.get("dateOfBirth"))==null?null:g.invalid),l(14),d("ngIf",(M=m.userForm.get("address.country"))==null?null:M.invalid),l(5),d("ngIf",(b=m.userForm.get("address.city"))==null?null:b.invalid),l(12),d("ngIf",(S=m.userForm.get("role"))==null?null:S.invalid),l(4),d("src",m.imagePreview||(m.currentUser==null?null:m.currentUser.avatar)||"assets/images/default-avatar.png",I)("alt",m.currentUser==null?null:m.currentUser.name),l(7),h(" ",m.selectedFile?m.selectedFile.name:"Change Profile Image"," "),l(4),d("disabled",m.userForm.invalid||m.isSubmitting)}}var ge=class a{constructor(e,t,o,s,g){this.fb=e;this.userService=t;this.snackBar=o;this.router=s;this.route=g;this.maxDate.setFullYear(this.maxDate.getFullYear()-18),this.userForm=this.fb.group({name:["",[p.required,p.minLength(2),p.maxLength(50)]],email:["",[p.required,p.email,p.pattern(/^\S+@\S+\.\S+$/)]],phone:["",[p.pattern(/^(01)(0|1|2|5)\d{8}$/)]],avatar:[""],dateOfBirth:["",[p.required,this.dateOfBirthValidator()]],gender:[""],address:this.fb.group({country:["",[p.required]],city:["",[p.required]]}),role:["",[p.required]]})}userForm;isSubmitting=!1;isLoading=!0;selectedFile=null;imagePreview=null;userId="";currentUser=null;maxDate=new Date;ngOnInit(){this.userId=this.route.snapshot.params.id,this.loadUser()}dateOfBirthValidator(){return e=>e.value?this.calculateAge(e.value)>=18?null:{underage:!0}:null}calculateAge(e){let t=new Date,o=new Date(e),s=t.getFullYear()-o.getFullYear(),g=t.getMonth()-o.getMonth();return(g<0||g===0&&t.getDate()<o.getDate())&&s--,s}loadUser(){this.userService.getUserById(this.userId).subscribe({next:e=>{this.currentUser=e,this.userForm.patchValue({name:e.name,email:e.email,phone:e.phone||"",role:e.role,avatar:e.avatar||"",dateOfBirth:e.dateOfBirth?new Date(e.dateOfBirth):"",gender:e.gender||"",address:{country:e.address?.country||"",city:e.address?.city||""}}),this.imagePreview=e.avatar||null,this.userForm.disable(),this.userForm.get("role")?.enable(),this.isLoading=!1},error:e=>{this.snackBar.open("Error loading user: "+e.message,"Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.router.navigate(["/users"])}})}onFileSelected(e){return O(this,null,function*(){let t=e.target.files?.[0];if(t){this.selectedFile=t;try{let o=yield this.convertFileToBase64(t);this.imagePreview=o,this.userForm.patchValue({avatar:o})}catch{this.snackBar.open("Error processing image","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"})}}})}convertFileToBase64(e){return new Promise((t,o)=>{let s=new FileReader;s.onload=()=>{t(s.result)},s.onerror=()=>{o(new Error("Failed to read file"))},s.readAsDataURL(e)})}onSubmit(){if(this.userForm.valid&&!this.isSubmitting){this.isSubmitting=!0;let e=this.userForm.value,t=F(P({},e),{dateOfBirth:e.dateOfBirth.toISOString()});this.userService.updateUser(this.userId,t).subscribe({next:()=>{this.snackBar.open("User updated successfully","Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.router.navigate(["/users"])},error:o=>{this.handleError("Error updating user: "+o.message)}})}}handleError(e){this.snackBar.open(e,"Close",{duration:3e3,horizontalPosition:"end",verticalPosition:"top"}),this.isSubmitting=!1}getErrorMessage(e){let t=this.userForm.get(e);if(t?.hasError("required"))return`${e.charAt(0).toUpperCase()+e.slice(1)} is required`;if(t?.hasError("email")||t?.hasError("pattern")&&e==="email")return"Please enter a valid email address";if(t?.hasError("minlength")){let o=t.getError("minlength").requiredLength;return`${e.charAt(0).toUpperCase()+e.slice(1)} must be at least ${o} characters`}if(t?.hasError("maxlength")){let o=t.getError("maxlength").requiredLength;return`${e.charAt(0).toUpperCase()+e.slice(1)} cannot exceed ${o} characters`}return t?.hasError("pattern")&&e==="phone"?"Please enter a valid Egyptian phone number":t?.hasError("underage")?"User must be at least 18 years old":""}static \u0275fac=function(t){return new(t||a)(_(z),_($),_(le),_(T),_(D))};static \u0275cmp=U({type:a,selectors:[["app-user-edit"]],decls:12,vars:2,consts:[["picker",""],["fileInput",""],[1,"page-container"],[1,"page-header"],[1,"header-content"],[1,"header-icon"],[1,"subtitle"],[1,"form-container","mat-elevation-z2"],["class","loading-spinner",4,"ngIf"],["class","user-form",3,"formGroup","ngSubmit",4,"ngIf"],[1,"loading-spinner"],["diameter","40"],[1,"user-form",3,"ngSubmit","formGroup"],[1,"form-row"],["appearance","outline"],["matInput","","formControlName","name","placeholder","Enter first name"],[4,"ngIf"],["matInput","","formControlName","email","placeholder","Enter email","type","email"],["matInput","","formControlName","phone","placeholder","Enter phone number"],["matInput","","formControlName","dateOfBirth","placeholder","Choose a date",3,"matDatepicker","max"],["matSuffix","",3,"for"],["disabled","",4,"ngIf"],["formControlName","gender"],["value","Male"],["value","Female"],["formGroupName","address",1,"form-row"],["matInput","","formControlName","country","placeholder","Enter country"],["matInput","","formControlName","city","placeholder","Enter city"],["formControlName","role"],["value","Guest"],["value","Host"],["value","Admin"],[1,"profile-image-section"],[1,"image-preview"],[1,"preview-image",3,"src","alt"],[1,"file-upload"],["type","file","accept","image/*",2,"display","none",3,"change"],["type","button","mat-stroked-button","",3,"click"],[1,"form-actions"],["type","button","mat-stroked-button","","routerLink","/users"],["type","submit","mat-raised-button","","color","primary",3,"disabled"],["disabled",""]],template:function(t,o){t&1&&(i(0,"div",2)(1,"div",3)(2,"div",4)(3,"h1")(4,"mat-icon",5),n(5,"edit"),r(),n(6," Edit User "),r(),i(7,"p",6),n(8,"Update user information"),r()()(),i(9,"div",7),c(10,he,2,0,"div",8)(11,Se,74,15,"form",9),r()()),t&2&&(l(10),d("ngIf",o.isLoading),l(),d("ngIf",!o.isLoading))},dependencies:[B,k,j,A,V,L,q,G,R,N,re,te,X,Z,ee,ne,ie,de,se,H,K,J,W,Q,me,oe,ae,fe,pe,ce,ue,Y],styles:[".page-container[_ngcontent-%COMP%]{padding:24px;max-width:800px;margin:0 auto}.page-header[_ngcontent-%COMP%]{margin-bottom:24px}.header-content[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{display:flex;align-items:center;margin:0;font-size:28px;font-weight:500;color:#1a1a1a}.header-icon[_ngcontent-%COMP%]{margin-right:12px;color:#ff385c}.subtitle[_ngcontent-%COMP%]{margin:4px 0 0;color:#666;font-size:14px}.form-container[_ngcontent-%COMP%]{background:#fff;padding:32px;border-radius:8px;position:relative;min-height:200px}.loading-spinner[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%)}.user-form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.form-row[_ngcontent-%COMP%]{display:flex;gap:16px;width:100%}.form-row[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{flex:1}.profile-image-section[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:16px}.current-image[_ngcontent-%COMP%]{width:100%;max-width:200px;margin:0 auto}.preview-image[_ngcontent-%COMP%]{width:100%;height:200px;object-fit:cover;border-radius:8px;box-shadow:0 2px 4px #0000001a}.file-upload[_ngcontent-%COMP%]{width:100%}.file-upload[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;padding:24px;border:2px dashed #e2e8f0;color:#4a5568}.file-upload[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{border-color:#ff385c;color:#ff385c}.file-upload[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-right:8px}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:16px;margin-top:16px}.form-actions[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]{background-color:#ff385c;color:#fff}.form-actions[_ngcontent-%COMP%]   button[type=submit][_ngcontent-%COMP%]:disabled{background-color:#0000001f;color:#00000061}@media (max-width: 600px){.page-container[_ngcontent-%COMP%]{padding:16px}.form-container[_ngcontent-%COMP%]{padding:24px}.form-row[_ngcontent-%COMP%]{flex-direction:column;gap:0}.form-actions[_ngcontent-%COMP%]{flex-direction:column-reverse}.form-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}"]})};export{ge as UserEditComponent};
